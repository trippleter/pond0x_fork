"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const task_names_1 = require("hardhat/builtin-tasks/task-names");
const config_1 = require("hardhat/config");
const wrapper_1 = require("hardhat/internal/core/providers/wrapper");
const hre_1 = require("../extend/hre");
const utils_1 = require("../utils");
const wrapper_2 = require("../wrapper");
(0, utils_1.createTracerTask)("node").setAction(utils_1.runTask);
(0, config_1.subtask)(task_names_1.TASK_NODE_GET_PROVIDER).setAction(async (args, hre, runSuper) => {
    const provider = await runSuper(args);
    (0, wrapper_2.wrapProvider)(hre, new RpcWrapper(hre, provider));
    (0, hre_1.addRecorder)(hre).catch(console.error);
    return hre.network.provider;
});
class RpcWrapper extends wrapper_1.ProviderWrapper {
    constructor(hre, provider) {
        super(provider);
        this.hre = hre;
        this.provider = provider;
    }
    async request({ method, params }) {
        if (method === "tracer_lastTrace") {
            const trace = this.hre.tracer.lastTrace();
            return JSON.parse(JSON.stringify(trace, (k, v) => (k === "parent" ? undefined : v)));
        }
        return this.provider.send(method, params);
    }
}
//# sourceMappingURL=node.js.map